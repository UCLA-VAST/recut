# These are example project actions that may be useful to consult for
# reference. Some commands may be environment specific
# all of these commands can be run in background as asynchronous
# jobs leveraging asynctasks.vim and asyncrun.vim

[project-init]
command=rm -rf build && cmake -H . -B build -DCMAKE_EXPORT_COMPILE_COMMANDS=ON -DRECUT_ENABLE_BENCHMARKING=ON -DCMAKE_CXX_COMPILER=g++ -DCMAKE_C_COMPILER=gcc -DUSE_MMAP=ON -DUSE_OMP_BLOCK=ON 
#-DUSE_MCP3D=ON 
#-DTEST_ALL_BENCHMARKS=ON
#-DLOG=ON -DLOG_FULL=ON -DFULL_PRINT=ON 
#-DCMAKE_CXX_COMPILER=clang++ -DCMAKE_BUILD_TYPE=Debug 
cwd=<root>

[project-build]
command=cd build && make -j 56 && make install -j 56
cwd=<root>

[project-test]
command=cd bin && ./recut_test --gtest_output=json:../data/test_detail.json --gtest_filter=Radius.Full
#--gtest_filter=*.ChecksIfFinalVerticesCorrect/11 | tee ../data/test_detail.log
cwd=<root>

# rebuild and run test
[project-change]
command=cd build && ninja install && cd ../bin && ./recut_test --gtest_output=json:../data/test_detail.json --gtest_filter=*.ChecksIfFinalVerticesCorrect/11
cwd=<root>

[project-bench]
command=cd bin && ./recut_bench --benchmark_filter=load_tile
cwd=<root>

[project-perf]
command=sudo cpupower frequency-set -g performance && cd bin && perf record -g recut_bench && sudo cpupower frequency-set -g powersave
#&& perf report -g 'graph,.9,caller'
#command=sudo cpupower frequency-set -g performance && cd bin && perf stat -e L1-dcache-misses L1-dcache-loads LLC-load-misses LLC-loads faults instructions cycles recut_bench && sudo cpupower frequency-set -g powersave
cwd=<root>

[project-run]
command=cd misc_scripts && python performance_test.py
cwd=<root>

[project-tags]
command=ctags -R --exclude={lib,bin,build,extern,docs,include}
cwd=<root>

[project-dev]
cmd=cd bin && ./recut_bench --benchmark_out=../data/dev.txt --benchmark_out_format=console --benchmark_filter=load*
cwd=<root>

# this is for output=quickfix only
# if it is omitted, vim's current errorformat will be used.
errorformat=%f:%m:%l

# save all files in buffer before executing any command
save=2
